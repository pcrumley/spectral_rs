use crate::{Float, Sim};
use itertools::izip;
const PI: Float = std::f64::consts::PI as Float;

pub struct WaveNumbers {
    pub k_x: Vec<Float>,
    pub k_y: Vec<Float>,
    pub k_norm: Vec<Float>,
}

impl WaveNumbers {
    pub fn new(sim: &Sim) -> WaveNumbers {
        let mut k_x = vec![0.0; sim.size_x * sim.size_y];
        let mut k_y = vec![0.0; sim.size_y * sim.size_x];
        let mut k_norm = vec![0.0; sim.size_y * sim.size_x];

        // Build the k basis of FFT
        for i in 0..sim.size_y {
            for j in 0..sim.size_x {
                let ind = i * sim.size_x + j;
                // FIRST DO K_X
                k_x[ind] = j as Float;
                if j >= sim.size_x / 2 + 1 {
                    k_x[ind] -= sim.size_x as Float;
                }
                k_x[ind] *= 2.0 * PI / (sim.size_x as Float);
                // NOW DO K_Y
                k_y[ind] = i as Float;
                if i >= sim.size_y / 2 + 1 {
                    k_y[ind] -= sim.size_y as Float;
                }
                k_y[ind] *= 2.0 * PI / (sim.size_y as Float);
            }
        }
        // Make the norm:
        for (norm, kx, ky) in izip!(&mut k_norm[1..], &k_x[1..], &k_y[1..]) {
            *norm = 1. / (kx * kx + ky * ky);
        }

        WaveNumbers { k_x, k_y, k_norm }
    }
}

#[cfg(test)]
pub mod tests {
    use super::*;
    use crate::{build_test_sim, E_TOL};

    #[test]
    fn wave_nums_init() {
        let sim = build_test_sim();
        let wave_nums = WaveNumbers::new(&sim);

        // we compare this to the python program
        // I wrote. But that was in double precision whereas
        // this one can be double OR single prec.

        let expected_wave_nums = WaveNumbers {
            k_x: vec![
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
                0.0,
                0.2617993877991494,
                0.5235987755982988,
                0.7853981633974483,
                1.0471975511965976,
                1.308996938995747,
                1.5707963267948966,
                1.832595714594046,
                2.0943951023931953,
                2.356194490192345,
                2.617993877991494,
                2.8797932657906435,
                3.141592653589793,
                -2.8797932657906435,
                -2.617993877991494,
                -2.356194490192345,
                -2.0943951023931953,
                -1.832595714594046,
                -1.5707963267948966,
                -1.308996938995747,
                -1.0471975511965976,
                -0.7853981633974483,
                -0.5235987755982988,
                -0.2617993877991494,
            ],
            k_y: vec![
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                0.5235987755982988,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.0471975511965976,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                1.5707963267948966,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.0943951023931953,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                2.617993877991494,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                3.141592653589793,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.617993877991494,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -2.0943951023931953,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.5707963267948966,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -1.0471975511965976,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
                -0.5235987755982988,
            ],
            k_norm: vec![
                0.0,
                14.590250444496641,
                3.6475626111241604,
                1.6211389382774044,
                0.9118906527810401,
                0.5836100177798658,
                0.4052847345693511,
                0.29776021315299267,
                0.22797266319526002,
                0.18012654869748937,
                0.14590250444496644,
                0.12058058218592266,
                0.10132118364233778,
                0.12058058218592266,
                0.14590250444496644,
                0.18012654869748937,
                0.22797266319526002,
                0.29776021315299267,
                0.4052847345693511,
                0.5836100177798658,
                0.9118906527810401,
                1.6211389382774044,
                3.6475626111241604,
                14.590250444496641,
                3.6475626111241604,
                2.9180500888993284,
                1.8237813055620802,
                1.1223269572689725,
                0.7295125222248321,
                0.5031120842929877,
                0.364756261112416,
                0.27528774423578567,
                0.21456250653671533,
                0.17165000522937224,
                0.14029086965862156,
                0.11672200355597313,
                0.09858277327362595,
                0.11672200355597313,
                0.14029086965862156,
                0.17165000522937224,
                0.21456250653671533,
                0.27528774423578567,
                0.364756261112416,
                0.5031120842929877,
                0.7295125222248321,
                1.1223269572689725,
                1.8237813055620802,
                2.9180500888993284,
                0.9118906527810401,
                0.8582500261468613,
                0.7295125222248321,
                0.5836100177798657,
                0.45594532639052004,
                0.3558597669389425,
                0.2805817393172431,
                0.2244653914537945,
                0.18237813055620802,
                0.15041495303604785,
                0.12577802107324693,
                0.10649817842698278,
                0.091189065278104,
                0.10649817842698278,
                0.12577802107324693,
                0.15041495303604785,
                0.18237813055620802,
                0.2244653914537945,
                0.2805817393172431,
                0.3558597669389425,
                0.45594532639052004,
                0.5836100177798657,
                0.7295125222248321,
                0.8582500261468613,
                0.4052847345693511,
                0.3943310930945038,
                0.364756261112416,
                0.3242277876554809,
                0.2805817393172431,
                0.23918443351633836,
                0.20264236728467555,
                0.17165000522937224,
                0.1459025044449664,
                0.12470299525210804,
                0.10728125326835766,
                0.09293153149360919,
                0.08105694691387022,
                0.09293153149360919,
                0.10728125326835766,
                0.12470299525210804,
                0.1459025044449664,
                0.17165000522937224,
                0.20264236728467555,
                0.23918443351633836,
                0.2805817393172431,
                0.3242277876554809,
                0.364756261112416,
                0.3943310930945038,
                0.22797266319526002,
                0.2244653914537945,
                0.21456250653671533,
                0.19986644444515947,
                0.18237813055620802,
                0.16393539825277126,
                0.1459025044449664,
                0.12911726057076672,
                0.11398633159763001,
                0.10062241685859752,
                0.08896494173473563,
                0.07886621861890077,
                0.07014543482931078,
                0.07886621861890077,
                0.08896494173473563,
                0.10062241685859752,
                0.11398633159763001,
                0.12911726057076672,
                0.1459025044449664,
                0.16393539825277126,
                0.18237813055620802,
                0.19986644444515947,
                0.21456250653671533,
                0.2244653914537945,
                0.14590250444496644,
                0.14445792519303607,
                0.14029086965862156,
                0.13385550866510681,
                0.12577802107324693,
                0.11672200355597316,
                0.10728125326835766,
                0.09792114392279626,
                0.08896494173473563,
                0.080609118477882,
                0.07295125222248322,
                0.06601923278052779,
                0.05979610837908459,
                0.06601923278052779,
                0.07295125222248322,
                0.080609118477882,
                0.08896494173473563,
                0.09792114392279626,
                0.10728125326835766,
                0.11672200355597316,
                0.12577802107324693,
                0.13385550866510681,
                0.14029086965862156,
                0.14445792519303607,
                0.10132118364233778,
                0.10062241685859752,
                0.09858277327362595,
                0.0953611140163179,
                0.091189065278104,
                0.08633284286684402,
                0.08105694691387022,
                0.07559715256215876,
                0.07014543482931078,
                0.06484555753109618,
                0.05979610837908459,
                0.05505754884715714,
                0.05066059182116889,
                0.05505754884715714,
                0.05979610837908459,
                0.06484555753109618,
                0.07014543482931078,
                0.07559715256215876,
                0.08105694691387022,
                0.08633284286684402,
                0.091189065278104,
                0.0953611140163179,
                0.09858277327362595,
                0.10062241685859752,
                0.14590250444496644,
                0.14445792519303607,
                0.14029086965862156,
                0.13385550866510681,
                0.12577802107324693,
                0.11672200355597316,
                0.10728125326835766,
                0.09792114392279626,
                0.08896494173473563,
                0.080609118477882,
                0.07295125222248322,
                0.06601923278052779,
                0.05979610837908459,
                0.06601923278052779,
                0.07295125222248322,
                0.080609118477882,
                0.08896494173473563,
                0.09792114392279626,
                0.10728125326835766,
                0.11672200355597316,
                0.12577802107324693,
                0.13385550866510681,
                0.14029086965862156,
                0.14445792519303607,
                0.22797266319526002,
                0.2244653914537945,
                0.21456250653671533,
                0.19986644444515947,
                0.18237813055620802,
                0.16393539825277126,
                0.1459025044449664,
                0.12911726057076672,
                0.11398633159763001,
                0.10062241685859752,
                0.08896494173473563,
                0.07886621861890077,
                0.07014543482931078,
                0.07886621861890077,
                0.08896494173473563,
                0.10062241685859752,
                0.11398633159763001,
                0.12911726057076672,
                0.1459025044449664,
                0.16393539825277126,
                0.18237813055620802,
                0.19986644444515947,
                0.21456250653671533,
                0.2244653914537945,
                0.4052847345693511,
                0.3943310930945038,
                0.364756261112416,
                0.3242277876554809,
                0.2805817393172431,
                0.23918443351633836,
                0.20264236728467555,
                0.17165000522937224,
                0.1459025044449664,
                0.12470299525210804,
                0.10728125326835766,
                0.09293153149360919,
                0.08105694691387022,
                0.09293153149360919,
                0.10728125326835766,
                0.12470299525210804,
                0.1459025044449664,
                0.17165000522937224,
                0.20264236728467555,
                0.23918443351633836,
                0.2805817393172431,
                0.3242277876554809,
                0.364756261112416,
                0.3943310930945038,
                0.9118906527810401,
                0.8582500261468613,
                0.7295125222248321,
                0.5836100177798657,
                0.45594532639052004,
                0.3558597669389425,
                0.2805817393172431,
                0.2244653914537945,
                0.18237813055620802,
                0.15041495303604785,
                0.12577802107324693,
                0.10649817842698278,
                0.091189065278104,
                0.10649817842698278,
                0.12577802107324693,
                0.15041495303604785,
                0.18237813055620802,
                0.2244653914537945,
                0.2805817393172431,
                0.3558597669389425,
                0.45594532639052004,
                0.5836100177798657,
                0.7295125222248321,
                0.8582500261468613,
                3.6475626111241604,
                2.9180500888993284,
                1.8237813055620802,
                1.1223269572689725,
                0.7295125222248321,
                0.5031120842929877,
                0.364756261112416,
                0.27528774423578567,
                0.21456250653671533,
                0.17165000522937224,
                0.14029086965862156,
                0.11672200355597313,
                0.09858277327362595,
                0.11672200355597313,
                0.14029086965862156,
                0.17165000522937224,
                0.21456250653671533,
                0.27528774423578567,
                0.364756261112416,
                0.5031120842929877,
                0.7295125222248321,
                1.1223269572689725,
                1.8237813055620802,
                2.9180500888993284,
            ],
        };
        for (v1, v2) in wave_nums.k_x.iter().zip(expected_wave_nums.k_x.iter()) {
            assert!((*v1 - *v2).abs() < E_TOL);
        }
        for (v1, v2) in wave_nums.k_y.iter().zip(expected_wave_nums.k_y.iter()) {
            assert!((*v1 - *v2).abs() < E_TOL);
        }
        for (v1, v2) in wave_nums
            .k_norm
            .iter()
            .zip(expected_wave_nums.k_norm.iter())
        {
            assert!((*v1 - *v2).abs() < E_TOL);
        }
    }
}
